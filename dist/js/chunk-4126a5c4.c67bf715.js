(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4126a5c4"],{"0d4b":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"article-container"},[n("van-nav-bar",{attrs:{fixed:"","left-arrow":"",title:"文章详情"},on:{"click-left":function(e){return t.$router.back()}}}),t.loading?n("van-loading",{staticClass:"article-loading"}):t._e(),t.is404?n("div",{staticClass:"error"},[n("p",[t._v("文章被外星人吃掉了")]),n("van-button",{on:{click:function(e){return t.$router.back()}}},[t._v("后退")]),n("van-button",{on:{click:function(e){return t.$router.push("/")}}},[t._v("回主页")])],1):n("div",{staticClass:"detail"},[n("h3",{staticClass:"title"},[t._v(t._s(t.article.title))]),n("div",{staticClass:"author"},[n("van-image",{attrs:{round:"",width:"1rem",height:"1rem",fit:"fill",src:t.article.aut_photo}}),n("div",{staticClass:"text"},[n("p",{staticClass:"name"},[t._v(t._s(t.article.aut_name))]),n("p",{staticClass:"time"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]),n("van-button",{attrs:{round:"",size:"small",type:"info"},on:{click:t.hSwitchFollow}},[t._v(t._s(t.article.is_followed?"取关":"+ 关注"))])],1),n("div",{staticClass:"content"},[n("div",{domProps:{innerHTML:t._s(t.article.content)}})]),n("van-divider",[t._v("END")]),n("div",{staticClass:"zan"},[n("van-button",{attrs:{round:"",size:"small",hairline:"",type:"primary",plain:"",icon:1===t.article.attitude?"good-job":"good-job-o"}},[t._v("点赞")]),t._v(" "),n("van-button",{attrs:{round:"",size:"small",hairline:"",type:"danger",plain:"",icon:"delete"}},[t._v("不喜欢")])],1)],1),n("article-comment",{ref:"refArticleComment",attrs:{articleId:t.articleId}})],1)},r=[],i=(n("d3b7"),n("25f0"),n("96cf"),n("1da1")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"article-comments"},[n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e){return n("van-cell",{key:e.com_id.toString()},[n("van-image",{staticStyle:{"margin-right":"10px"},attrs:{slot:"icon",round:"",width:"30",height:"30",src:e.aut_photo},slot:"icon"}),n("span",{staticStyle:{color:"#466b9d"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.aut_name))]),n("div",{attrs:{slot:"label"},slot:"label"},[n("p",{staticStyle:{color:"#363636"}},[t._v(t._s(e.content))]),n("p",[n("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t._f("relativeTime")(e.pubdate)))]),n("van-button",{attrs:{size:"mini",type:"default"},on:{click:function(n){return t.hReply(e)}}},[t._v("回复"+t._s(e.reply_count))])],1)]),n("van-icon",{attrs:{slot:"right-icon",name:"like-o"},slot:"right-icon"})],1)})),1),n("van-cell-group",{staticClass:"publish-wrap"},[n("van-field",{attrs:{clearable:"",placeholder:"请输入评论内容"},model:{value:t.content,callback:function(e){t.content="string"===typeof e?e.trim():e},expression:"content"}},[n("van-button",{attrs:{slot:"button",size:"mini",type:"info"},on:{click:t.hAddComment},slot:"button"},[t._v("发布")])],1)],1),n("van-popup",{style:{height:"80%"},attrs:{round:"",position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?n("comment-reply",{attrs:{currentComment:t.currentComment,articleId:t.articleId},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},c=[],s=n("2909"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"article-comments"},[n("van-nav-bar",{attrs:{title:t.currentComment.reply_count+"条回复"}},[n("van-icon",{attrs:{slot:"left",name:"cross"},on:{click:function(e){return t.$emit("close")}},slot:"left"})],1),n("van-cell",{attrs:{title:"当前评论"}},[n("van-image",{staticStyle:{"margin-right":"10px"},attrs:{slot:"icon",round:"",width:"30",height:"30",src:t.currentComment.aut_photo},slot:"icon"}),n("span",{staticStyle:{color:"#466b9d"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.currentComment.aut_name))]),n("div",{attrs:{slot:"label"},slot:"label"},[n("p",{staticStyle:{color:"#363636"}},[t._v(t._s(t.currentComment.content))]),n("p",[n("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t._f("relativeTime")(t.currentComment.pubdate)))]),n("van-button",{attrs:{size:"mini",type:"default"}},[t._v("回复"+t._s(t.currentComment.reply_count))])],1)]),n("van-icon",{attrs:{slot:"right-icon"},slot:"right-icon"})],1),n("van-divider",[t._v("全部回复")]),n("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了"},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(e,a){return n("van-cell",{key:a},[n("van-image",{staticStyle:{"margin-right":"10px"},attrs:{slot:"icon",round:"",width:"30",height:"30",src:e.aut_photo},slot:"icon"}),n("span",{staticStyle:{color:"#466b9d"},attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.aut_name))]),n("div",{attrs:{slot:"label"},slot:"label"},[n("p",{staticStyle:{color:"#363636"}},[t._v(t._s(e.content))]),n("p",[n("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(t._f("relativeTime")(e.pubdate)))])])])],1)})),1),n("van-cell-group",{staticClass:"publish-wrap"},[n("van-field",{attrs:{clearable:"",placeholder:"请输入回复内容"},model:{value:t.content,callback:function(e){t.content="string"===typeof e?e.trim():e},expression:"content"}},[n("van-button",{attrs:{slot:"button",size:"mini",type:"info"},on:{click:t.hAddReply},slot:"button"},[t._v("发布")])],1)],1)],1)},u=[],d=n("b775"),p=function(t,e){return Object(d["a"])({method:"POST",url:"/app/v1_0/comments",data:{target:t,content:e}})},m=function(t,e,n){return Object(d["a"])({method:"POST",url:"/app/v1_0/comments",data:{target:t,content:n,art_id:e}})},f=function(t,e){return Object(d["a"])({method:"GET",url:"/app/v1_0/comments",params:{type:"a",source:t,offset:e}})},v=function(t,e){return Object(d["a"])({method:"GET",url:"/app/v1_0/comments",params:{type:"c",source:t,offset:e}})},h={name:"CommentReply",props:{currentComment:{type:Object,required:!0},articleId:{type:String,required:!0}},data:function(){return{content:"请回复",offset:null,list:[],loading:!1,finished:!1}},methods:{hAddReply:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(""!==t.content){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,m(t.currentComment.com_id.toString(),t.articleId,t.content);case 6:n=e.sent,t.list.unshift(n.data.data.new_obj),t.$toast.success("回复成功"),t.content="",t.currentComment.reply_count++,e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](3),t.$toast("回复失败");case 18:case"end":return e.stop()}}),e,null,[[3,14]])})))()},onLoad:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.currentComment.com_id.toString(),e.next=3,v(a,t.offset);case 3:r=e.sent,i=r.data.data.results,(n=t.list).push.apply(n,Object(s["a"])(i)),t.offset=r.data.data.last_id,t.loading=!1,0===i.length&&(t.finished=!0);case 9:case"end":return e.stop()}}),e)})))()}}},b=h,_=(n("2223"),n("2877")),g=Object(_["a"])(b,l,u,!1,null,"63c550ce",null),w=g.exports,y={name:"ArticleComment",props:{articleId:{type:String,required:!0}},components:{CommentReply:w},data:function(){return{currentComment:{},isReplyShow:!1,offset:null,content:"",list:[],loading:!1,finished:!1}},methods:{hReply:function(t){this.isReplyShow=!0,this.currentComment=t},hAddComment:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(""!==t.content){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,p(t.articleId,t.content);case 5:n=e.sent,t.list.unshift(n.data.data.new_obj),t.$toast.success("评论成功"),t.content="",e.next=16;break;case 12:e.prev=12,e.t0=e["catch"](2),t.$toast("文章没有开放评论权限");case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))()},onLoad:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f(t.articleId,t.offset);case 2:a=e.sent,r=a.data.data.results,(n=t.list).push.apply(n,Object(s["a"])(r)),t.offset=a.data.data.last_id,t.loading=!1,0===r.length&&(t.finished=!0);case 8:case"end":return e.stop()}}),e)})))()}}},x=y,C=(n("cd92"),Object(_["a"])(x,o,c,!1,null,"4b765953",null)),k=C.exports,S=n("c24f"),j=n("2423"),O={name:"ArticleIndex",components:{ArticleComment:k},data:function(){return{is404:!1,articleId:null,loading:!0,article:{}}},created:function(){this.articleId=this.$route.params.id,this.loadArticle()},methods:{hSwitchFollow:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.article,a=n.is_followed,r=n.aut_id,!a){e.next=8;break}return e.next=4,Object(S["e"])(r.toString());case 4:t.article.is_followed=!1,t.$toast.success("取关成功"),e.next=19;break;case 8:return e.prev=8,e.next=11,Object(S["a"])(r.toString());case 11:t.article.is_followed=!0,t.$toast.success("加关注成功"),e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](8),t.$toast.fail("加关注失败");case 19:case"end":return e.stop()}}),e,null,[[8,15]])})))()},loadArticle:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,e.next=4,Object(j["b"])(t.articleId);case 4:n=e.sent,t.article=n.data.data,t.loading=!1,e.next=14;break;case 9:e.prev=9,e.t0=e["catch"](1),t.is404=e.t0.response&&404===e.t0.response.status,t.$toast.fail("加载失败"),t.loading=!1;case 14:case"end":return e.stop()}}),e,null,[[1,9]])})))()}},beforeRouteLeave:function(t,e,n){if(this.$refs.refArticleComment.content){var a=window.confirm("页面上有评论，如果离开就会丢失，你确定吗?");a?n():n(!1)}else n()}},R=O,$=(n("26cd"),Object(_["a"])(R,a,r,!1,null,"1b7da78a",null));e["default"]=$.exports},2223:function(t,e,n){"use strict";var a=n("99c1"),r=n.n(a);r.a},"26cd":function(t,e,n){"use strict";var a=n("2ac4"),r=n.n(a);r.a},"2ac4":function(t,e,n){},"99c1":function(t,e,n){},c24f:function(t,e,n){"use strict";n.d(e,"d",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return c})),n.d(e,"e",(function(){return s})),n.d(e,"g",(function(){return l})),n.d(e,"f",(function(){return u}));var a=n("b775"),r=function(t,e){return Object(a["a"])({url:"/app/v1_0/authorizations",method:"POST",data:{mobile:t,code:e}})},i=function(){return Object(a["a"])({method:"GET",url:"/app/v1_0/user"})},o=function(){return Object(a["a"])({method:"GET",url:"/app/v1_0/user/profile"})},c=function(t){return Object(a["a"])({method:"POST",url:"/app/v1_0/user/followings",data:{target:t}})},s=function(t){return Object(a["a"])({method:"DELETE",url:"/app/v1_0/user/followings/"+t})},l=function(t){return Object(a["a"])({method:"PATCH",url:"/app/v1_0/user/profile",data:t})},u=function(t){return Object(a["a"])({method:"PATCH",url:"/app/v1_0/user/photo",data:t})}},cd92:function(t,e,n){"use strict";var a=n("d13a"),r=n.n(a);r.a},d13a:function(t,e,n){}}]);
//# sourceMappingURL=chunk-4126a5c4.c67bf715.js.map