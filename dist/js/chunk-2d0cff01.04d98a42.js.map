{"version":3,"sources":["webpack:///./src/views/user/profile.vue?22ee","webpack:///src/views/user/profile.vue","webpack:///./src/views/user/profile.vue?4b70","webpack:///./src/views/user/profile.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","$router","back","ref","hPhotoChange","hShowSelectImage","user","photo","slot","name","showName","gender","showGender","birthday","showBirthday","hSaveName","model","value","callback","$$v","expression","newName","trim","hSaveGender","minDate","maxDate","hSaveBirthday","newDate","staticRenderFns","data","Date","created","loadProfile","methods","$refs","refPhoto","click","component"],"mappings":"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","file":"js/chunk-2d0cff01.04d98a42.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('van-nav-bar',{attrs:{\"left-arrow\":\"\",\"title\":\"编辑资料\"},on:{\"click-left\":function($event){return _vm.$router.back()}}}),_c('van-cell-group',[_c('input',{ref:\"refPhoto\",attrs:{\"type\":\"file\",\"hidden\":\"\"},on:{\"change\":_vm.hPhotoChange}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"头像\",\"center\":\"\"},on:{\"click\":_vm.hShowSelectImage}},[_c('van-image',{attrs:{\"slot\":\"default\",\"width\":\"1.5rem\",\"height\":\"1.5rem\",\"fit\":\"cover\",\"round\":\"\",\"src\":_vm.user.photo},slot:\"default\"})],1),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"姓名\",\"value\":_vm.user.name},on:{\"click\":function($event){_vm.showName=true}}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"性别\",\"value\":_vm.user.gender === 1 ? '女':'男'},on:{\"click\":function($event){_vm.showGender=true}}}),_c('van-cell',{attrs:{\"is-link\":\"\",\"title\":\"生日\",\"value\":_vm.user.birthday},on:{\"click\":function($event){_vm.showBirthday=true}}})],1),_c('van-dialog',{attrs:{\"title\":\"修改名字\",\"show-cancel-button\":\"\"},on:{\"confirm\":_vm.hSaveName},model:{value:(_vm.showName),callback:function ($$v) {_vm.showName=$$v},expression:\"showName\"}},[_c('van-field',{model:{value:(_vm.newName),callback:function ($$v) {_vm.newName=(typeof $$v === 'string'? $$v.trim(): $$v)},expression:\"newName\"}})],1),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.showGender),callback:function ($$v) {_vm.showGender=$$v},expression:\"showGender\"}},[_c('van-nav-bar',{attrs:{\"title\":\"修改性别\",\"left-text\":\"取消\"},on:{\"click-left\":function($event){_vm.showGender=false}}}),_c('van-cell',{attrs:{\"title\":\"男\",\"is-link\":\"\"},on:{\"click\":function($event){return _vm.hSaveGender(0)}}}),_c('van-cell',{attrs:{\"title\":\"女\",\"is-link\":\"\"},on:{\"click\":function($event){return _vm.hSaveGender(1)}}})],1),_c('van-popup',{attrs:{\"position\":\"bottom\"},model:{value:(_vm.showBirthday),callback:function ($$v) {_vm.showBirthday=$$v},expression:\"showBirthday\"}},[_c('van-nav-bar',{attrs:{\"title\":\"修改生日\"}}),_c('van-datetime-picker',{attrs:{\"type\":\"date\",\"title\":\"选择年月日\",\"min-date\":_vm.minDate,\"max-date\":_vm.maxDate},on:{\"cancel\":function($event){_vm.showBirthday=false},\"confirm\":_vm.hSaveBirthday},model:{value:(_vm.newDate),callback:function ($$v) {_vm.newDate=$$v},expression:\"newDate\"}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"container\">\r\n    <!-- 导航条 -->\r\n    <van-nav-bar\r\n      left-arrow\r\n      @click-left=\"$router.back()\"\r\n      title=\"编辑资料\">\r\n    </van-nav-bar>\r\n\r\n    <!-- 编辑区 -->\r\n    <van-cell-group>\r\n      <!-- hidden : 隐藏自已。但是，它的功能是正常的。 -->\r\n      <input type=\"file\" hidden @change=\"hPhotoChange\" ref=\"refPhoto\"/>\r\n      <van-cell is-link title=\"头像\" center @click=\"hShowSelectImage\">\r\n        <van-image\r\n          slot=\"default\"\r\n          width=\"1.5rem\"\r\n          height=\"1.5rem\"\r\n          fit=\"cover\"\r\n          round\r\n          :src=\"user.photo\"\r\n        />\r\n      </van-cell>\r\n        <!-- value： 设置右侧显示的文字 -->\r\n      <van-cell is-link title=\"姓名\" :value=\"user.name\" @click=\"showName=true\"/>\r\n\r\n      <van-cell is-link title=\"性别\" :value=\"user.gender === 1 ? '女':'男'\" @click=\"showGender=true\"/>\r\n\r\n      <van-cell is-link title=\"生日\" :value=\"user.birthday\" @click=\"showBirthday=true\"/>\r\n    </van-cell-group>\r\n\r\n    <!-- 修改名字 -->\r\n    <van-dialog\r\n      v-model=\"showName\"\r\n      title=\"修改名字\"\r\n      show-cancel-button\r\n      @confirm=\"hSaveName\">\r\n      <van-field v-model.trim=\"newName\" />\r\n    </van-dialog>\r\n\r\n    <!-- 修改性别 -->\r\n      <van-popup v-model=\"showGender\" position=\"bottom\">\r\n        <van-nav-bar title=\"修改性别\" left-text=\"取消\" @click-left=\"showGender=false\">\r\n        </van-nav-bar>\r\n        <van-cell title=\"男\" @click=\"hSaveGender(0)\" is-link></van-cell>\r\n        <van-cell title=\"女\" @click=\"hSaveGender(1)\" is-link></van-cell>\r\n      </van-popup>\r\n\r\n    <!-- 修改生日 -->\r\n      <van-popup v-model=\"showBirthday\" position=\"bottom\">\r\n        <van-nav-bar title=\"修改生日\">\r\n        </van-nav-bar>\r\n        <van-datetime-picker\r\n          v-model=\"newDate\"\r\n          type=\"date\"\r\n          title=\"选择年月日\"\r\n          @cancel=\"showBirthday=false\"\r\n          @confirm=\"hSaveBirthday\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n        />\r\n      </van-popup>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport { getProfile, updateUserInfo, updatePhoto } from '@/api/user'\r\nimport dayjs from 'dayjs'\r\nexport default {\r\n  name: 'userProfile',\r\n  data () {\r\n    return {\r\n      // 控制弹层\r\n      showName: false,\r\n      showGender: false,\r\n      showBirthday: false,\r\n\r\n      // 当前用户的信息\r\n      user: { name: '张三' },\r\n\r\n      // 修改后的新名字\r\n      newName: '',\r\n      // 修改后新生日\r\n      newDate: new Date(),\r\n      minDate: new Date(2000, 0, 10), // dateTime-picker中最小时间: 2000年1月10号\r\n      maxDate: new Date() // 当前时间\r\n    }\r\n  },\r\n  created () {\r\n    this.loadProfile()\r\n  },\r\n  methods: {\r\n    // 用户在头像上点击，希望也弹出文件选择框\r\n    // 移花接木\r\n    hShowSelectImage () {\r\n      // 就相当于直接在input type=\"file\" 上点击\r\n      this.$refs.refPhoto.click()\r\n    },\r\n    // 用户选择头像\r\n    async hPhotoChange () {\r\n      // 1. 获取当前的头像文件\r\n      // console.dir(this.$refs.refPhoto)\r\n      // this.$refs.refPhoto 获取当前的dom对象。\r\n      // files: 这个input文件域有一个属性名是files，其中保存是的当前\r\n      // 用户选择的所有的文件。由于这里只是一个单选，则选中的文件一定放在下\r\n      // 标为0的位置\r\n      const file = this.$refs.refPhoto.files[0]\r\n      if (!file) {\r\n        return\r\n      }\r\n      this.$toast.loading({\r\n        duration: 0, // 永远不会关闭\r\n        mask: true,\r\n        message: '操作中....'\r\n      })\r\n      try {\r\n        // 2. 调用接口向服务器传\r\n        // (1) 由于上传是文件，需要用FormData动态构建参数\r\n        const fd = new FormData()\r\n        fd.append('photo', file)\r\n        // (2) 调用接口发请求\r\n        const result = await updatePhoto(fd)\r\n        // const result = await updatePhoto({ photo: file })  // 错误的写法\r\n        // 3. 更新视图\r\n        this.user.photo = result.data.data.photo\r\n\r\n        // 4. 保存到vuex\r\n        this.$store.commit('mSetUserPhoto', this.user.photo)\r\n\r\n        this.$toast.success('修改头像成功')\r\n      } catch {\r\n        this.$toast.fail('修改头像失败')\r\n      }\r\n    },\r\n    // 修改名字\r\n    async hSaveName () {\r\n      if (this.newName === '') {\r\n        return\r\n      }\r\n      this.$toast.loading({\r\n        duration: 0, // 永远不会关闭\r\n        mask: true,\r\n        message: '操作中....'\r\n      })\r\n\r\n      try {\r\n        // 1. 调用接口，发请求，修改名字\r\n        const result = await updateUserInfo({\r\n          name: this.newName\r\n        })\r\n        console.log(result)\r\n        // 2. 更新视图\r\n        this.user.name = this.newName\r\n        this.newName = ''\r\n        this.$toast.success('修改名字成功')\r\n      } catch {\r\n        this.$toast.fail('修改名字失败')\r\n      }\r\n    },\r\n\r\n    async hSaveGender (gender) {\r\n      this.$toast.loading({\r\n        duration: 0, // 永远不会关闭\r\n        mask: true,\r\n        message: '操作中....'\r\n      })\r\n\r\n      try {\r\n        // 1. 调用接口，发请求，修改性别\r\n        const result = await updateUserInfo({\r\n          gender\r\n        })\r\n        console.log(result)\r\n        // 2. 更新视图\r\n        this.user.gender = gender\r\n\r\n        this.$toast.success('修改性别成功')\r\n        // 3. 收起弹层\r\n        this.showGender = false\r\n      } catch (err) {\r\n        this.$toast.fail('修改性别失败')\r\n      }\r\n    },\r\n    // 保存生日\r\n    async hSaveBirthday () {\r\n      const birthday = dayjs(this.newDate).format('YYYY-MM-DD')\r\n      console.log(birthday)\r\n\r\n      this.$toast.loading({\r\n        duration: 0, // 永远不会关闭\r\n        mask: true,\r\n        message: '操作中....'\r\n      })\r\n\r\n      try {\r\n        // 1. 调用接口，发请求，修改生日\r\n        const result = await updateUserInfo({\r\n          birthday\r\n        })\r\n        console.log(result)\r\n        // 2. 更新视图\r\n        this.user.birthday = birthday\r\n\r\n        // 3. 收起弹层\r\n        this.showBirthday = false\r\n\r\n        this.$toast.success('修改生日成功')\r\n      } catch {\r\n        this.$toast.fail('修改生日失败')\r\n      }\r\n    },\r\n\r\n    async loadProfile () {\r\n      const result = await getProfile()\r\n      console.log(result)\r\n      this.user = result.data.data\r\n      this.newName = this.user.name\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./profile.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./profile.vue?vue&type=template&id=06abb2ec&\"\nimport script from \"./profile.vue?vue&type=script&lang=js&\"\nexport * from \"./profile.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}